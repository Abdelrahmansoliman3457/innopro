<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/select2.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="css/flat.css" />
    <link rel="stylesheet" href="css/style.css" />
    <!-- <link rel="stylesheet" href="css/ltr-style.css" /> -->
    <title>fainancial</title>
</head>

<body>
    <div class="nav-layer"></div>
    <!-- ************** start to loader ************** -->
    <div class="loader-container">
        <span class="loader"></span>
    </div>
    <!-- ************** End to loader ************** -->

    <div class="sidebar" id="sidebar">
        <div class="close" id="closeSidebar">
            <i class="fa-solid fa-xmark"></i>
        </div>
        <div class="content">
            <div class="flex-sm-gap spe-lo-pad flex-group-me mb-4">
                <img src="https://innoprosa.net/admin_assets/images/logo.png" class="logo-dash" alt="logo">
            </div>
            <ul class="links">
                <li>
                    <a href="index.html">
                        <span class="icon-co">
                            <img src="imgs/home-06.png" alt="" />
                        </span>
                        الرئيسية
                    </a>
                </li>
                <li>
                    <a href="goInside.html">
                        <span class="icon-co">
                            <img src="imgs/login-square-02.png" alt="" />
                        </span>
                        اشعارات الدخول
                    </a>
                </li>
                <li>
                    <a href="fainancial.html">
                        <span class="icon-co">
                            <img src="imgs/activity-03.png" alt="" />
                        </span>
                        الحركات المالية
                    </a>
                </li>
                <li>
                    <a href="invoices.html">
                        <span class="icon-co">
                            <img src="imgs/invoice-03.png" alt="" />
                        </span>
                        ادارة الفواتير
                    </a>
                </li>
                <li>
                    <a href="premitions.html">
                        <span class="icon-co">
                            <img src="imgs/activity-03.png" alt="" />
                        </span>
                        التصاريح
                    </a>
                </li>
                <li>
                    <a href="faults.html">
                        <span class="icon-co">
                            <img src="imgs/activity-03.png" alt="" />
                        </span>
                        المخالفات
                    </a>
                </li>
                <li>
                    <a href="wallet.html">
                        <span class="icon-co">
                            <img src="imgs/wallet-add-01 (1).png" alt="" />
                        </span>
                        شحن المحفظة
                    </a>
                </li>
                <li>
                    <a href="profile-choose.html">
                        <span class="icon-co">
                            <img src="imgs/account-setting-03.png" alt="" />
                        </span>
                        الملف الشخصي
                    </a>
                </li>


                <li>
                    <button data-bs-toggle="modal" data-bs-target="#logout-modal"
                        class="log-out-red item-click d-flex reset-btn w-100">
                        <span class="icon-co">
                            <img src="imgs/noun_logout.png" alt="" />
                        </span>
                        تسجيل الخروج
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <nav class="navbar-me" id="navbar">
        <div class="container">
            <div class="content">
                <div class="flex-sm-gap">

                    <div class="menu" id="menu">
                        <i class="fa-solid fa-bars"></i>
                    </div>
                    <form action="" class="search-form">
                        <div class="middle-form relative-parent search-main">
                            <input type="text" placeholder="كلمات مفتاحية" class="main-input" />
                            <button type="submit" class="fl-bt">
                                <i class="fa-solid fa-magnifying-glass"></i>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="left">
                    <div class="not search-mmain pointer-click">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                    <div class="not">
                        <a href="notifications.html"></a>
                        <i class="fa-regular fa-bell"></i>
                        <span class="number">3</span>
                    </div>
                    <div class="header-mode">
                        <i class="fa-regular fa-sun"></i>
                    </div>
                    <div class="header-language">
                        <img src="imgs/saudi.png" alt="lang" />
                    </div>

                    <div>
                        <div class="account flex-profile-btn">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" alt="img"
                                class="profile-img" />
                            <div class="info">
                                <h3>عبدالرحمن</h3>
                                <span>المدير العام</span>
                            </div>
                            <div class="icon-pro">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                            <ul class="my-drop-now">
                                <li>
                                    <a href="profile.html" class="flex-in-drop">
                                        <img src="imgs/test1.png" alt="img">
                                        <div class="in-f-text">ادارة الحساب</div>
                                    </a>
                                </li>
                                <li>
                                    <a href="reset-pass.html" class="flex-in-drop">
                                        <img src="imgs/test2.png" alt="img">
                                        <div class="in-f-text">تغيير كلمة المرور</div>
                                    </a>
                                </li>
                                <li>
                                    <a href="invoices.html" class="flex-in-drop">
                                        <img src="imgs/test3.png" alt="img">
                                        <div class="in-f-text">سجل الفواتير</div>
                                    </a>
                                </li>

                                <li>
                                    <a href="login.html" class="flex-in-drop red-drop">
                                        <img src="imgs/test4.png" alt="img">
                                        <div class="in-f-text">تسجيل الخروج</div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </nav>

    <main class="main-sec" id="main">
        <div class="container">
            <div class="col-lg-10 col-12 margin-auto">
                <div class="chat-body pt-0">
                    <div class="chat-header">
                        <div class="flex-sm-gap">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="user-main-img" alt="img">

                            <div class="right-h">
                                <h6 class="mb-2">الدعم الفني</h6>
                                <p class="gray-col font12">يمكنك مراسلة الدعم الفني من هنا</p>
                            </div>

                        </div>
                        <div class="flex-sm-gap voice-m">

                            <div >جاري التسجيل ... <i class="fa-solid fa-circle text-danger"></i></div>
                            <button type="button" class="main-btn up stop-record">ايقاف</button>
                        </div>
                    </div>
                    <div class="chat-messages">
                        <div class="message-single mb-3 sender">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                            <div class="message-contain">
                                <div class="message-text regular mb-1 font12">
                                    نص تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي .. نص
                                    تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي ..
                                </div>
                                <div class="font12">16.50</div>
                            </div>
                        </div>
                        <div class="message-single mb-3 reciever">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                            <div class="message-contain">
                                <div class="message-text regular mb-1 font12">
                                    نص تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي .. نص
                                    تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي ..
                                </div>
                                <div class="font12">16.50</div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-senders">
                        <!-- <input type="text" class="main-input input-chat-m" placeholder="اكتب رسالتك هنا" /> -->
                        <textarea name="" id="" oninput="textareaWhrite()" class="main-textarea input-chat-m" placeholder="اكتب رسالتك هنا"></textarea>
                        <label class="mb-0 label-chat" for="filesNext_input">
                            <input type="file" data-single="true" hidden id="filesNext_input"
                                class="heddenUploud files-input files-upload-chat" name="filesNext[]" data-input="filesNext"
                                value="" />
                                <i class="fa-solid fa-file"></i>
                        </label>
                        <label class="mb-0 label-chat voice-main">
                            <i class="fa-solid fa-microphone"></i>
                        </label>
                        <button class="un-styled-btn send-message">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="uploaded__area area-uploaded" id="filesNext_cont"></div>
                </div>
            </div>



        </div>
    </main>

    <!-- Modal confirm logout -->
    <div class="modal fade" id="logout-modal" tabindex="-1" aria-labelledby="logout-modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content main-redious">
                <div class="modal-body maodal-pad text-center">
                    <div class="flex-group-me mb-5 mt-3">
                        <img class="modal-img-m" src="imgs/amico.png" alt="" />
                    </div>
                    <h6 class="text-center mb-4">هل انت متاكد من تسجيل الخروج؟</h6>

                    <div class="flex-group-me mb-3">
                        <button type="button" onclick="window.location = 'login.html'" class="main-btn  up">
                            <div class="follow-text">نعم</div>
                        </button>
                        <button type="button" class="main-btn up  light-b" data-bs-dismiss="modal">
                            تراجع
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/select2.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/flat.js"></script>
    <script src="js/main.js"></script>


    <script>
        // Send voice message
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];
    let isCancelled = false;

    function startRecording() {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function (stream) {
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                isRecording = true;
                isCancelled = false;
                document.querySelector(".send-message").classList.remove("d-none");
                document.querySelector(".send-message").classList.add("d-block");
                document.querySelector(".voice-m").classList.remove("d-none");
                document.querySelector(".voice-m").classList.add("d-flex");
                document.querySelector(".voice-main").classList.add("d-none");
                document.querySelector(".voice-main").classList.remove("d-block");

                mediaRecorder.ondataavailable = function (event) {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = function () {
                    if (!isCancelled) {
                        const audioBlob = new Blob(audioChunks, { 'type': 'audio/wav' });
                        audioChunks = [];
                        const audioUrl = URL.createObjectURL(audioBlob);
                        sendVoiceMessage(audioUrl);
                    }
                    textareaWhrite()

                };
            });
    }

    function stopRecording() {
        if (mediaRecorder && isRecording) {
            mediaRecorder.stop();
            isRecording = false;
            document.querySelector(".voice-m").classList.remove("d-flex");
            document.querySelector(".voice-m").classList.add("d-none");
        }
    }

    function cancelRecording() {
        if (mediaRecorder && isRecording) {
            isCancelled = true;
            mediaRecorder.stop();
            isRecording = false;
            audioChunks = []; // Clear the recorded audio chunks

            // Hide "Cancel" button when recording is canceled
            document.querySelector(".voice-m").classList.add("d-none");
        }
        // mediaRecorder.stop();
    }

    function sendVoiceMessage(audioUrl) {
        // console.log(isAppend);
        
        
            
            let realMessage = `<div class="message-single mb-3 sender">
                                <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                                <div class="message-contain">
                                  <audio controls src="${audioUrl}"></audio>
                                  <div class="font12">${new Date().toLocaleTimeString()}</div>
                                </div>
                              </div>`;
            chatArea.insertAdjacentHTML("beforeend", realMessage);
            chatArea.scroll(0, 5000);
        
        stopRecording(); 
    }

    // Voice recording button
    let recordBtn = document.querySelector(".voice-main");
    recordBtn.addEventListener("click", startRecording );
    // document.querySelector(".stop-record").addEventListener("click", stopRecording);
    document.querySelector(".send-message").addEventListener("click", stopRecording);
    document.querySelector(".stop-record").addEventListener("click", cancelRecording);
    </script>


    <!--chat-->
    <script>
        // send message with enter
        document.querySelector(".input-chat-m").addEventListener("keyup", function (event) {
            if (event.keyCode === 13 && !event.shiftKey) {
                document.querySelector(".send-message").click();
                textareaWhrite()
            }
        })
        // add new line to textarea with shift + enter
        document.querySelector(".input-chat-m").addEventListener("keyup", function (event) {
            if (event.keyCode === 13 && event.shiftKey) {
                event.preventDefault();
                document.querySelector(".input-chat-m").value += "\n";
              
            }
        })

        function textareaWhrite() {
            if(document.querySelector(".input-chat-m").value.trim() != ""){
                document.querySelector(".send-message").classList.remove("d-none");
                document.querySelector(".voice-main").classList.add("d-none");
                document.querySelector(".send-message").classList.add("d-flex");
                document.querySelector(".voice-main").classList.remove("d-flex");
            } else{
                document.querySelector(".send-message").classList.remove("d-flex");
                document.querySelector(".send-message").classList.add("d-none");
                document.querySelector(".voice-main").classList.remove("d-none");
                document.querySelector(".voice-main").classList.add("d-flex");
            }
        }
        let chatBtn = document.querySelector(".send-message");
        let chatInput = document.querySelector(".input-chat-m");
        let chatArea = document.querySelector(".chat-messages");
        let filesInput = document.querySelector(".files-upload-chat");
        let areaUploaded = document.querySelector(".area-uploaded");
        // send text
        function sendTextOnly() {
            let inputMessage = chatInput.value;
            let realMessage = `<div class="message-single mb-3 sender">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                            <div class="message-contain">
                              <div class="message-text regular mb-1 font12">
                                 ${inputMessage}
                              </div>
                              <div class="font12">${new Date().toLocaleTimeString()}</div>
                            </div>
                          </div>`;
            chatArea.insertAdjacentHTML("beforeend", realMessage);
            chatInput.value = "";
            chatArea.scroll(0, 5000);
            chatInput.focus();
            textareaWhrite()
            checkLenght()
        }
        // send files
        function sendFilesOnly() {
            if (inputsFiles.filesNext[0].type.split("/")[0] == "image") {
                let imgSrc = URL.createObjectURL(inputsFiles.filesNext[0]);
                console.log(inputsFiles.filesNext[0]);

                let realMessage = `<div class="message-single mb-3 sender">
                              <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                              <div class="message-contain">
                                <a data-fancybox="gallery" class="mb-1" href="${imgSrc}">
                                  <img src="${imgSrc}" />
                                </a>
                                <div class="font12">${new Date().toLocaleTimeString()}</div>
                              </div>
                            </div>`;
                chatArea.insertAdjacentHTML("beforeend", realMessage);
            } else {
                let imgSrc = URL.createObjectURL(inputsFiles.filesNext[0]);
                let imgName = inputsFiles.filesNext[0].name;

                let realMessage = `<div class="message-single mb-3 sender">
                              <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                              <div class="message-contain">
                                <a target="_blank" class="mb-1 pdf-style" href="${imgSrc}">
                                  <span><i class="far fa-file-pdf mr-1 ml-1"></i></span>
      
                                  ${imgName}
                                </a>
                                <div class="font12">${new Date().toLocaleTimeString()}</div>
                              </div>
                            </div>`;
                chatArea.insertAdjacentHTML("beforeend", realMessage);
            }
            areaUploaded.innerHTML = "";
            filesInput.value = "";
            chatArea.scroll(0, 5000);
            chatInput.focus();
            checkLenght()
        }


        chatBtn.addEventListener("click", function () {
            if (chatInput.value.trim().length > 0 && !filesInput.value.length) {
                sendTextOnly();
            } else if (
                filesInput.value.length &&
                chatInput.value.trim().length < 1
            ) {
                sendFilesOnly()
            } else if (
                filesInput.value.length &&
                chatInput.value.trim().length > 0
            ) {
                sendTextOnly();
                sendFilesOnly()
            }
        });
        textareaWhrite()
    </script>
    <!------------abload files------------->
    <script>
        function checkLenght() {
            if ($(".files-input").val().length) {
                document.querySelector(".send-message").classList.remove("d-none");
                document.querySelector(".voice-main").classList.add("d-none");
                document.querySelector(".send-message").classList.add("d-flex");
                document.querySelector(".voice-main").classList.remove("d-flex");
                document.querySelector(".input-chat-m").setAttribute("disabled", true);
                
            } else {
                document.querySelector(".send-message").classList.remove("d-flex");
                document.querySelector(".send-message").classList.add("d-none");
                document.querySelector(".voice-main").classList.remove("d-none");
                document.querySelector(".voice-main").classList.add("d-flex");
                document.querySelector(".input-chat-m").removeAttribute("disabled");
            }
        }
        let inputsFiles = {};
        $(".files-input").on("change", function (event) {
            
            // check if input has value
            checkLenght()
     
            let input = $(this).data("input");
            const selectedFilesCont = document.getElementById(input + "_cont");
            if (!!inputsFiles[input]) {
                let files = new DataTransfer();
                for (let i = 0; i < event.target.files.length; i++) {
                    files.items.add(event.target.files[i]);
                }
                for (let i = 0; i < inputsFiles[input].length; i++) {
                    files.items.add(inputsFiles[input][i]);
                }
                inputsFiles[input] = files.files;
                selectedFilesCont.innerHTML = "";
            } else {
                inputsFiles[input] = event.target.files;
            }
            if (!!inputsFiles[input] && inputsFiles[input].length > 0) {
                if ($(this).data("single") == true) {
                    selectedFilesCont.innerHTML = "";
                    inputsFiles[input] = event.target.files;
                }
                for (let i = 0; i < inputsFiles[input].length; i++) {
                    const fileType = inputsFiles[input][i].type.split("/")[0];
                    if (fileType === "image") {
                        let src = URL.createObjectURL(inputsFiles[input][i]);
                        $("#" + input + "_cont").append(` <div class="file_">
                                                                                  <a data-fancybox="gallery" href="${src}">
                                                                                      <img src="${src}" alt="">
                                                                                  </a>
                                                                                  <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                              </div>`);
                    } else if (fileType === "video") {
                        let src = URL.createObjectURL(inputsFiles[input][i]);

                        $("#" + input + "_cont").append(`<div class="file_">
                                                                                  <a data-fancybox="gallery" data-type="video" href="${src}">
                                                                                      <video controls>
                                                                                          <source src="${src}" type="video/mp4">
                                                                                      </video>
                                                                                      <div class="play-button"><i class="fas fa-play-circle"></i></div>
                                                                                  </a>
                                                                                  <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                              </div>`);
                    } else {
                        $("#" + input + "_cont").append(`<div class="file_">
                                                                                  <div class="docs_file">
                                                                                      <div class="d-flex flex-column align-items-center justify-content-center h-100 p-2">
                                                                                          <span class="font10">${inputsFiles[input][i].name}</span>
                                                                                          <span><i class="far fa-file-pdf mr-1 ml-1"></i></span>
                                                                                      </div>
                                                                                  </div>
                                                                                  <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                              </div>`);
                    }
                }
            }
            event.target.files = inputsFiles[input];
        });

        function deleteFile(ele, name, input) {
         
            let filesInput = document.getElementById(input + "_input");
            let files = new DataTransfer();
            let deleted = null;
            for (let i = 0; i < filesInput.files.length; i++) {
                if (filesInput.files[i].name == name && deleted != name) {
                    deleted = name;
                    continue;
                }
                files.items.add(filesInput.files[i]);
            }
            filesInput.files = files.files;
            inputsFiles[input] = files.files;

            // edit the number of parents to delete
            $(ele).parent().remove();

                   // check if input has value
                   checkLenght()
        }
    </script>



</body>

</html>